version: '3.8'

services:
  k2think-api:
    image: julienol/k2think2api:latest
    container_name: k2think-api
    ports:
      - "${HOST_PORT:-8001}:8001"
    volumes:
      # 挂载数据目录（包含accounts.txt）
      - ./data:/app/data
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONIOENCODING=utf-8
      - PYTHONLEGACYWINDOWSSTDIO=0
      - LC_ALL=C.UTF-8
      - LANG=C.UTF-8
      # Token自动更新配置（启动即刷新，纯内存模式）
      - ENABLE_TOKEN_AUTO_UPDATE=true
      # accounts.txt路径（必需）
      - ACCOUNTS_FILE=/app/data/accounts.txt
      # 更新间隔（秒），默认24小时
      - TOKEN_UPDATE_INTERVAL=86400
      # 并发获取token的线程数
      - TOKEN_MAX_WORKERS=2
    restart: unless-stopped